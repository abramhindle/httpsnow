<!doctype html>
<html>
  <head>
    <title>Magic!</title>
    <style>
#multibuttonpanel {
        width: 100%;
       height: 75%;
}
#sliderpanel {
        width: 100%;
       height: 25%;
}


html, body {
   height: 100%;
   width: 100%;
   margin: 0;
   padding: 0;
}
</style>
        <script src="./www.charlie-roberts.com/interface/build/interface.js"></script>

    <script src="./www.charlie-roberts.com/gibberish/build/gibberish.js"></script>
  </head>
    <body>
    <div id="multibuttonpanel">
    </div>
    <div id="sliderpanel">
    </div>
    <script>
/* Some ideas were taken from

 * Mozilla https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia

*/





Gibberish.Step = function() {
      Gibberish.extend(this, {
        name:'step',
        properties: {
            amp:1,
            value:0.0,
        },        
        callback : function(amp, value){ 
            return amp * value;
        },
    });
    this.init();
    this.oscillatorInit();
    this.processProperties(arguments);  
};
Gibberish.Step.prototype = Gibberish._oscillator;


window.addEventListener("load", function() {
    console.log("onload");
    Gibberish.init();
    Gibberish.Time.export();
    Gibberish.Binops.export();
    q = new Gibberish.Step(1.0,0.0);
    //q = 0;
    /*
    var polySynth = new Gibberish.Synth2({ maxVoices:4, waveform:'PWM', attack:ms(1), decay:ms(500) }).connect();
        
    var synthNote = function(runsum,od,b) {
        for (var i = 0 ; i < b.length; i++) {
            if (b[i] >= trigger) {
                polySynth.note(40+i*100);
            }
        }
    };
    */
    /* stolen from http://www.charlie-roberts.com/interface/ by Charlie Roberts */
    var a = new Interface.Panel({ container:("#multibuttonpanel") });
    b = null;
    var multiButton = new Interface.MultiButton({
        row:8, columns:8,
        bounds:[.05,.05,.9,.8],
        onvaluechange : function(row, col, value) {
            multiButtonLabel
                .setValue( 'row : ' + row + ' , col : ' + col + ' , value : ' + value);
            //polySynth.note(20 + 10*col + 40*row);
            if (b!=null) {
                b.position = (col * 8 + row) / 64.0;
            }
            //q.value = 10*(col * 8 + row);
            q.value = 2*(col * 8 + row);
            //console.log(q);
        },
    });
    multiButton.mode = "contact";
    console.log(multiButton);
    var multiButtonLabel = new Interface.Label({ 
        bounds:[.05,.9, .9, .1],
        hAlign:"left",
        value:""
    });
    
    a.background = 'black';
    a.add(multiButton, multiButtonLabel);
    
    var sliderPanel = new Interface.Panel({ container:document.querySelector("#sliderpanel") });            
    var multiSlider = new Interface.MultiSlider({ 
        count:15,
        bounds:[.05,.05,.9,.8],
        onvaluechange : function(number, value) {
            multiSliderLabel.setValue( 'num : ' + number + ' , value : ' + value);
        }
    });

    var multiSliderLabel = new Interface.Label({ 
        bounds:[.05, .9, .9, .1],
        hAlign:"left",
        value:" ",
    });

    sliderPanel.background = 'black';
    sliderPanel.add(multiSlider, multiSliderLabel);
    
    var trumpet = new Gibberish.Sampler('./www.charlie-roberts.com/gibberish/resources/trumpet.wav');
    trumpet.onload = function() {
        trumpet.loops = true;        
        b = new Gibberish.Granulator({ 
            buffer:trumpet.getBuffer(),
            grainSize:1000,
            speedMin: -2,
            speedMax: 2,
        });
        //b.mod('position', new Gibberish.Sine(.1, .45), '+');
        //b.connect();
        console.log(b);
        b.amp = 1.0;
        k = new Gibberish.Bus();
        e = new Gibberish.Sine(Add(220,q,new Gibberish.Sine(Add(21,new Gibberish.Sine(10.0,20)), 200)), 100.0);
        Clamp(e,-0.2,0.2).connect(k);
        //Clamp(Merge(trumpet),-0.0001,0.0001).connect();
        Clamp(Mul(10,Mod(Mul(128,Merge(b)),64)),-0.5,0.5).connect(k);
        k.connect();
        //c = Clamp(Mul(100,k),-0.5,0.5);
        //c = Mul(100.0,Clamp(k,-0.01,0.01));
        //r = new Gibberish.Reverb({input:c, roomSize:.5, wet:1, dry:.25}).connect();
        //c = Gibberish.Binops.Clamp(b,-0.01,0.01);//{input:b,min:0.01,max:-0.01});
        //c.connect();
        //trumpet.note(1);
        //console.log(c);
        console.log("connected");
    };
    //mod2 = new Gibberish.Sine(0.5, 50); 
    //sin = new Gibberish.Sine( Add(60,Clamp(mod2,20,40)), .25 ).connect()
    

    console.log("Done on load");
});



    </script>        
  </body>
</html>
